# Flatpak.
## Как изменить место установки Flatpak?
В Manjaro Linux (и других дистрибутивах) есть два основных способа изменить место установки Flatpak: через создание конфигурации «пользовательской установки» или с помощью символических ссылок.
### Способ 1: Настройка новой точки установки (рекомендуемый)
Этот метод позволяет добавить диск `/mnt/HDD01/` как официальное место для приложений Flatpak.
1. Создайте папку на новом диске:
```
sudo mkdir -p /mnt/HDD01/flatpak
```
2. Создайте файл конфигурации:
```
sudo mkdir -p /etc/flatpak/installations.d
sudo nano /etc/flatpak/installations.d/hdd.conf
```
3. Вставьте следующее содержимое:
```
ini
[Installation "hdd"]
Path=/mnt/HDD01/flatpak/
DisplayName=HDD Installation
StorageType=harddisk
```
4. Добавьте репозиторий Flathub для этой точки
```
flatpak --installation=hdd remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
```
5. Установка: Чтобы установить программу на этот диск, используйте флаг `--installation=hdd`:
```
flatpak install --installation=hdd flathub имя_программы
```
Если этот диск станет единственным источником для Flathub, флаг можно будет опускать.

---
### Способ 2: Использование символической ссылки (простой перенос)
Этот метод перенаправляет стандартную папку установки Flatpak на ваш диск.

1. Перенесите существующие данные (если есть):
```
sudo mv /var/lib/flatpak /mnt/HDD01/flatpak-data
```

2. Создайте ссылку:
```
sudo ln -s /mnt/HDD01/flatpak-data /var/lib/flatpak
```

Теперь все «системные» Flatpak будут физически находиться на `/mnt/HDD01/`.

Важные примечания:
- Монтирование: Убедитесь, что диск `/mnt/HDD01/` автоматически монтируется при загрузке системы через `/etc/fstab`, иначе приложения не запустятся.
- Права доступа: Убедитесь, что у пользователя есть права на чтение и выполнение в новой директории.
- Переменные окружения: Вы также можете изменить путь через переменные `FLATPAK_SYSTEM_DIR` и `FLATPAK_USER_DIR` в файле `/etc/environment`, но способ с конфигурацией (Способ 1) считается более гибким.

---


## Куда по умолчанию устанавливаются программы из Flatpak?
Пути установки Flatpak зависят от режима (системный или пользовательский), в котором была запущена команда установки:

1. Системная установка (по умолчанию): приложения устанавливаются в директорию `/var/lib/flatpak/`. Этот путь используется, если вы устанавливаете пакеты через центр программ (Pamac, Discover) или командой `sudo flatpak install`.
2. Пользовательская установка: если используется флаг `--user` (например, `flatpak install --user`), приложения сохраняются в домашнюю папку по адресу `~/.local/share/flatpak/`.

Независимо от места установки самой программы, её личные данные и конфигурационные файлы всегда создаются в домашнем каталоге пользователя по пути: `~/.var/app/ID_приложения/`. Основные компоненты внутри папок установки:
   - `app/` — сами файлы приложений.
   - `runtime/` — необходимые для работы библиотеки (среды выполнения).
   - `exports/share/` — ярлыки (.desktop файлы) и иконки, которые позволяют запускать программы через основное меню системы.
---

## Как удалить полностью программы из flatpak?
Для полного удаления программ Flatpak, включая их настройки, кэш и неиспользуемые библиотеки, выполните следующие действия в терминале:
1. Удаление конкретного приложения с его данными
Обычная команда удаления оставляет пользовательские настройки в папке `~/.var/app/`. Чтобы удалить программу вместе с ними, используйте флаг `--delete-data`:
```
flatpak uninstall --delete-data ID_приложения
# ID приложения выглядит как org.mozilla.firefox или com.spotify.Client
```
2. Очистка «остатков» от уже удаленных программ
Если вы уже удалили программы ранее обычным способом, их конфигурационные файлы всё ещё занимают место. Чтобы найти и удалить все «осиротевшие» данные приложений, выполните:
```
flatpak uninstall --delete-data
```
Система предложит по очереди удалить папки данных для всех программ, которые больше не установлены.

3. Удаление неиспользуемых библиотек (Runtimes)
Flatpak часто оставляет после себя среды выполнения (например, старые версии GNOME Platform), которые больше не нужны ни одному приложению. Очистите их командой:
```
flatpak uninstall --unused
```
Это одна из самых эффективных команд для освобождения места.

4. Очистка системного кэша (опционально)
Если нужно очистить временные файлы установки, можно удалить содержимое папки кэша:
```
sudo rm -rf /var/tmp/flatpak-cache-*
```

Итог (короткий путь):
Чтобы удалить вообще всё, что связано с Flatpak (все приложения и их данные):
```
flatpak uninstall --all --delete-data
flatpak uninstall --unused
```
---

## Команды для Flatpak
### Управление приложениями
1. Установка приложения (например, flatpak install flathub org.gimp.GIMP).
```
flatpak install [remote] [ID]
```

2. Удаление приложения.
```
flatpak uninstall [ID]
```

3. Запуск приложения через терминал.
```
flatpak run [ID]
```

4. Обновление всех установленных программ и системных сред.
```
flatpak update
```

5. Поиск приложений в подключенных репозиториях.
```
flatpak search [запрос]
```
---

### Просмотр информации
1. Список всех установленных приложений и библиотек (runtimes).
```
flatpak list
```

2. Показать только приложения.
```
flatpak list --app
```

3. Подробная информация о конкретном приложении (версия, разрешения, путь установки).
```
flatpak info [ID]
```

4. Просмотр истории изменений (установки, обновления, удаления).
```
flatpak history 
```
---

### Очистка системы
1. Удаление неиспользуемых библиотек и сред выполнения, которые больше не нужны ни одной программе.
```
flatpak uninstall --unused
```

2. Удаление приложения вместе с его пользовательскими данными в `~/.var/app/`.
```
flatpak uninstall --delete-data [ID] 
```

3. Полное удаление всех приложений Flatpak.
```
flatpak uninstall --all
```
---

### Управление репозиториями (Remotes)
1. Список всех подключенных источников.
```
flatpak remotes (или remote-list) 
```

2. Добавление нового репозитория (например, Flathub).
```
flatpak remote-add --if-not-exists flathub [URL]
```

3. Удаление источника из системы.
```
flatpak remote-delete [name]
```
---

### Продвинутые команды и отладка
1. Проверка и исправление целостности файлов установки при возникновении ошибок.
```
flatpak repair
```

2. Список запущенных в данный момент Flatpak-процессов.
```
flatpak ps 
```

3. Ручное изменение прав доступа приложения к папкам (например, чтобы дать доступ к вашему HDD).
```
flatpak override [ID] --filesystem=[path] 
```

4. Запрет на автоматическое обновление конкретного приложения.
```
flatpak mask [ID]
```
---

### Управление правами доступа (Sandbox)
Flatpak-приложения работают в изолированной «песочнице». Вы можете изменять их права вручную:
1. Дать приложению доступ к конкретной папке (например, вашему диску `/mnt/HDD01/`).
```
flatpak override [ID] --filesystem=/путь
```

2. Запретить приложению использовать определенный протокол (например, принудительно запустить через X11 для совместимости)
```
flatpak override [ID] --nosocket=wayland
```

3. Сбросить все ручные изменения прав доступа к заводским настройкам приложения.
```
flatpak override --reset [ID]
```
---

### Заморозка обновлений (Masking)
Если новая версия программы работает нестабильно, вы можете «замаскировать» её, чтобы она не обновлялась:
1. Запретить обновление конкретного приложения.
```
flatpak mask [ID]
```

2. Снова разрешить обновления.
```
flatpak mask --remove [ID]
```

3. Показать список всех заблокированных обновлений.
```
flatpak mask
```
---

### Диагностика и исправление
Если Flatpak ведет себя странно или приложения не запускаются:
1. Сканирует установленные пакеты на наличие повреждений и пытается их восстановить.
```
flatpak repair
```

2. Войти в оболочку (shell) запущенного контейнера приложения для отладки путей или переменных окружения.
```
flatpak enter [ID] sh
```

3. Показывает список запущенных в данный момент Flatpak-приложений и их идентификаторы процессов.
```
flatpak ps
```
---

### Работа с версиями и рантаймами
1. Закрепить рантайм (библиотеку), чтобы команда `uninstall --unused` не удалила его автоматически (полезно для старых приложений).
```
flatpak pin [ID]
```

2. Вывести список приложений с указанием их размера и места установки (системное или на другом диске).
```
flatpak list --columns=app,size,installation
```

3. Проверить наличие обновлений в репозиториях без их немедленной установки.
```
flatpak remote-ls --updates
```
---

### Создание портативных копий
Скопировать установленное приложение и его зависимости на USB-накопитель для установки на другой компьютер без интернета.
```
flatpak create-usb [путь_к_носителю] [ID]
```
---


