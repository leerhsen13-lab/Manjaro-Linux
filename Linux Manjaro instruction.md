# Полезные инструкции для Linux Manjaro.

## Настройка ограничения FPS в играх Steam?
1. Параметры запуска Steam (для многих игр, работающих на движке Source).
   * Откройте Библиотеку Steam.
   * Кликните правой кнопкой мыши по нужной игре и выберите Свойства.
   * Во вкладке «Общие» найдите поле Параметры запуска.
   * Впишите команду, где 60 — желаемый предел кадров
```
+fps_max 60
```
2.  Настройки видеокарт (для NVIDIA, позволяет ограничить FPS глобально для всех игр или индивидуально для каждой).
       * Нажмите правой кнопкой мыши на рабочем столе и выберите Панель управления NVIDIA.
       * Перейдите в раздел «Управление параметрами 3D».
       * Выберите вкладку «Программные настройки» для конкретной игры или «Глобальные параметры» для всех игр.
       * Найдите пункт «Максимальная частота кадров» (Max Frame Rate), установите значение «Вкл» и введите лимит кадров.
3. Сторонние программы (если в игре нет встроенного ограничителя, можно использовать специальные утилиты)
      * RivaTuner Statistics Server (RTSS): Позволяет устанавливать лимит FPS для отдельных игр или глобально. Утилита поддерживает горячие клавиши для переключения профилей.
      * MangoHud (для Linux): Используется для настройки ограничений FPS через команды запуска, например: 
```
MANGOHUD_CONFIG="fps_limit=60" mangohud %command%
```

## Настройка автоматического монтирования второго диска в Manjaro.
Через файл `/etc/fstab` (метод работает везде и не зависит от графической оболочки.)
   * Узнайте UUID диска
```
lsblk -f
```   
   * Найдите свой диск (например, sdb1) и скопируйте его UUID (длинный код из букв и цифр)
   * Создайте папку для монтирования, например, с названием storage в корневом каталоге `mnt`
```
sudo mkdir /mnt/storage
```
   * Отредактируйте файл конфигурации
```
sudo nano /etc/fstab
```
   * В самый конец файла добавьте новую строку (используя свой UUID и путь)
```
UUID=ваш-uuid-код-здесь  /mnt/storage  ext4  defaults,noatime  0  2
```
   * Если диск отформатирован в NTFS (от Windows), вместо ext4 напишите
```
ntfs-3g
# или
lowntfs-3g
```
   * Проверьте работу (без перезагрузки). Если команда **не** выдала ошибок, значит диск примонтирован, и будет подключаться автоматически при каждом включении.
```
sudo mount -a
```


## 3. Увеличение файла подкачки в Manjaro
Увеличить файл подкачки (swap file) в Manjaro Linux можно путем создания дополнительного файла подкачки или изменения размера существующего. В Manjaro часто используется файл подкачки, а не отдельный раздел подкачки.
Процесс безопасного увеличения файла подкачки включает несколько шагов с использованием терминала.

#### Способ 1. Создание и добавление нового файла подкачки.
Простой способ добавить дополнительный объем к существующему файлу подкачки без необходимости изменять его размер.
   * Откройте терминал и создайте новый файл подкачки нужного размера. Например, для создания файла размером 4 гигабайта (используя bs=1M и count=4096, где $4096 * 1МБ = 4ГБ). Назовем его swapfile2.
```
sudo fallocate -l 4G /swapfile2

# Если fallocate не работает, можно использовать
sudo dd if=/dev/zero of=/swapfile2 bs=1M count=4096
```
  * Установите права доступа к файлу
```
sudo chmod 600 /swapfile2
```
  * Сделайте файл файлом подкачки Linux
```
sudo mkswap /swapfile2
```
  * Активируйте новый файл подкачки немедленно
```
sudo swapon /swapfile2
```
  * Убедитесь, что новый объем подкачки используется. В строке Swap вы увидите суммарный объем подкачки.
```
free -h
```
  * Сделайте изменения постоянными (автоматическое монтирование при загрузке) через файл `/etc/fstab`
```
sudo nano /etc/fstab
```
  * Добавьте следующую строку в конец файла и сохраните его (используйте `Ctrl+O` для сохранения и `Ctrl+X` для выхода в nano)
```
/swapfile2 none swap defaults 0 0
```
  * После перезагрузки системы новый файл подкачки будет автоматически активирован.


#### Способ 2. Увеличение существующего файла подкачки
Если вы хотите именно увеличить размер файла подкачки, который уже используется системой (/swapfile).
  * Отключите текущий файл подкачки
```
sudo swapoff /swapfile
```
  * Увеличьте его размер с помощью fallocate (например до 8G)
```
sudo fallocate -l 8G /swapfile
```
  * Повторно сделайте файл файлом подкачки Linux (это необходимо делать каждый раз при изменении размера)
```
sudo mkswap /swapfile
```
  * Установите права доступа (на всякий случай)
```
sudo chmod 600 /swapfile
```
  * Снова включите подкачку
```
sudo swapon /swapfile
```
  * Проверьте результат командой
```
free -h
```


#### Совет по swappiness (агрессивность использования подкачки)
По умолчанию Linux может довольно активно использовать файл подкачки. Если вы хотите, чтобы система обращалась к диску только тогда, когда оперативная память действительно заканчивается (что часто желательно для игр), вы можете уменьшить параметр `swappiness`.
   * Посмотрите текущее значение (обычно 60)
```
cat /proc/sys/vm/swappiness
```
   * Установите менее агрессивное значение (например, 10) временно
```
sudo sysctl vm.swappiness=10
```
   * Сделайте изменение постоянным через файл `/etc/sysctl.d/99-sysctl.conf` и добавьте строку `vm.swappiness=10`

#### Использование двух файлов подкачки
В Linux можно одновременно использовать два и более файлов подкачки (или разделов подкачки). Это абсолютно нормальная и поддерживаемая функция системы.
Зачем это может понадобиться?
  * Гибкость: проще добавить второй файл подкачки, чем менять размер первого.
  * Производительность: при наличии двух жестких дисков (не разделов на одном), размещение файлов подкачки на обоих может немного ускорить операции подкачки, так как система может читать и писать данные параллельно.

Manjaro Linux использует параметр приоритета `pri=...` для управления несколькими областями подкачки.

Пример настройки `/etc/fstab` с приоритетами для `/swapfile` (на быстром SSD) и `/swapfile2` (на медленном HDD):
```
# Быстрый SSD, высокий приоритет
/swapfile   none  swap  defaults,pri=100  0  0

# Медленный HDD, низкий приоритет
/swapfile2  none  swap  defaults,pri=10   0  0
```
Система будет заполнять файл с более высоким приоритетом (100) сначала, и только когда он заполнится, перейдет ко второму (10).
Использование двух файлов подкачки полностью поддерживается. Это хороший способ увеличить общий объем подкачки, если не хватает текущего размера.

## 4. Обновление зеркал
Используйте встроенную утилиту `pacman-mirrors`. Она протестирует скорость серверов и выберет лучшие.
   * Обновить зеркала и выбрать 10 самых быстрых
```
sudo pacman-mirrors --fasttrack 10
```
   * Обновить зеркала только в вашей или соседних странах (для лучшего пинга). Вы можете заменить страны на те, что ближе к вам. Использование протокола https повышает безопасность
```
sudo pacman-mirrors --country Russia,Germany,France --api --proto https
```
   * После обновления зеркал ОБЯЗАТЕЛЬНО нужно синхронизировать базу данных
```
sudo pacman -Syyu
```

*Примечание*: двойная буква `y` заставляет систему полностью обновить базу данных, даже если она кажется актуальной.


## 5. Как установить обновления?
  * Создайте список пользовательских пакетов для последующего использования
```
pamac list --foreign > ~/alien-pkgs.txt
```
  * Удалите все посторонние пакеты
```
pamac remove $(pamac list --foreign --quiet)
```
  * Remove all orphans and other unneeded packages
```
pamac remove --orphans --unneeded
```
  * Запустите обновление
```
pamac update --dry-run
```
  * Повторите без "--dry-run"
```
pamac update
reboot
```

  * Просмотрите список пакетов, созданных на первом шаге, и перестройте только те, которые вам действительно нужны

## 6. Проверка, что обновления прошли успешно

  * Проверка через терминал после завершения команды
```
sudo pacman -Syu
# или 
pamac update
```

**Успешное завершение**:
   * [Y/n] для подтверждения, а после установки всех пакетов — нет ошибок;
   * transaction successfully finished - транзакция успешно завершена;
   * nothing to do - нечего делать, если обновлений не было.
**Неуспешное завершение**:
Красные надписи error, failed to commit transaction (не удалось завершить транзакцию) или package validation failed, значит, что-то пошло не так, и обновления не были завершены успешно.

  * Проверка версии установленных пакетов, например, ядро Linux
```
uname -r
```

#### Если обновления зависли или выдали ошибку
Если в процессе обновления возникли ошибки или система зависла, не перезагружайте компьютер сразу. Попробуйте выполнить команду, которая заново синхронизирует и обновит систему, иногда с принудительной очисткой кэша

  * Принудительное обновление и очистка кэша, если были ошибки. Эта команда часто помогает решить проблемы с конфликтами файлов, которые иногда возникают в Manjaro.
```
sudo pacman -Syyu --overwrite '*'
```
