# Обслуживание системы Manjaro Linux.
## Полезные команды для терминала
### Управление системой и обновлениями
1. Полное обновление системы и синхронизация репозиториев.
```
sudo pacman -Syu
```
  - `-S` — синхронизация пакетов
  - `-y` — обновление баз данных
  - `-u` — обновление всех пакетов

```
# перед обновлением проверьте наличие новостей о системе
sudo pacman -Syu --needed manjaro-system
```

2. Обновляет систему, включая пакеты из AUR (пользовательского репозитория), что удобнее стандартного pacman.
```
pamac upgrade -a
```

3. Проверка наличия обновлений (включая AUR) без их установки.
```
pamac checkupdates -a
```

4. Принудительное обновление базы данных пакетов, полезно, если списки пакетов повредились.
```
sudo pacman -Syyu
```
---

### Установка и удаление программ
1. Установка программы из официальных репозиториев.
```
sudo pacman -S [имя_пакета]
```

2. Сборка и установка пакета из AUR.
```
pamac build [имя_пакета]
```

3. Удаление программы.
```
sudo pacman -R [имя_пакета]

# удаление вместе с зависимостями и конфигами
sudo pacman -Rns [имя_пакета]
```

4. Поиск программ в репозиториях.
```
pacman -Ss [ключевое_слово]
```

5. Просмотр списка установленных пакетов.
```
pacman -Q`

# чтобы экспортировать список в файл
pacman -Qe > paketi.txt
```

6. Просмотр информации о пакете.
```
pacman -Si имя_пакета

# для установленных пакетов
pacman -Qi имя_пакета
```
---

### Обслуживание и очистка (Maintenance)
1. Показать «сирот» (пакеты, которые больше не нужны ни одной программе).
```
pamac list -o
```

2. Удалить все ненужные пакеты-сироты.
```
pamac remove -o
```

3. Очистка кэша пакетов.
```
sudo pacman -Sc

# для удаления всех неиспользуемых пакетов
sudo pacman -R $(pacman -Qdtq)
```
    
4. Очистить кэш пакетов, оставив только последние 3 версии (помогает освободить место на диске).
```
sudo paccache -rk3
```

5. Включить автоматическую синхронизацию времени (критично для корректной работы обновлений).
```
timedatectl set-ntp true
```

6. Проверка целостности системы.
```
sudo pacman -Qk
```

7. Просмотр логов системы.
```
journalctl -xe

# для просмотра логов за сегодня
journalctl --since today
```
---

### Исправление ошибок
1. Обновление ключей безопасности (часто помогает, если обновление выдает ошибки «invalid or corrupted package»).
```
sudo pacman -Sy archlinux-keyring manjaro-keyring
```

1. Обновление с возможностью «отката» пакетов (используется при переключении между ветками Manjaro, например, с Testing на Stable).
```
sudo pacman -Syuu
```

**Совет**: Для повседневного использования в Manjaro рекомендуется использовать pamac, так как он лучше интегрирован с особенностями дистрибутива и поддерживает AUR «из коробки».

---

## Команды для pamac

Pamac в терминале часто удобнее, чем pacman, так как он автоматически управляет зависимостями AUR, Flatpak и Snap без необходимости вводить sudo (пароль будет запрошен только при подтверждении действия).

### Основные операции
1. Полное обновление системы. Добавьте флаг `-a` (`--aur`), чтобы обновить и пакеты из AUR.
```
pamac update или pamac upgrade
```

2. Установка пакета.
```
pamac install [имя_пакета]
```

3. Сборка и установка пакета конкретно из AUR.
```
pamac build [имя_пакета]
yay -S [имя_пакета]
```

4. Удаление пакета.
```
pamac remove [имя_пакета]
```

5. Переустановка пакета.
```
pamac reinstall [имя_пакета]
```
---

### Поиск и информация
1. поиск программ в репозиториях.
```
pamac search [запрос]
```

2. подробная информация о пакете (версия, размер, зависимости).
```
pamac info [имя]
```

3. список всех установленных в системе пакетов.
```
pamac list -i
```

4. список только тех пакетов, которые были установлены вручную.
```
pamac list -m —
```
---

### Обслуживание системы (Cleaning)
1. Поиск «сирот» (пакетов, которые больше не нужны системе).
```
pamac list -o
```

2. Удаление всех обнаруженных «сирот».
```
pamac remove -o
```

3. Очистка кэша: удаляет все версии пакетов, кроме трех последних сохраненных (безопасный способ освободить место).
```
pamac clean --keep 3
```

4. Полная очистка кэша загруженных пакетов (использовать с осторожностью).
```
pamac clean
```
---

### Дополнительные возможности
1. Проверка доступных обновлений без начала процесса.
```
pamac checkupdates
```

2. Скачивание файлов сборки из AUR без их компиляции (полезно для ручного редактирования PKGBUILD).
```
pamac clone [имя]
```

**Важно**: В отличие от pacman, при использовании pamac в терминале не рекомендуется использовать префикс `sudo`. Команда сама инициирует запрос прав администратора, когда это потребуется для записи в системные директории.

---

### Глубокое обновление и работа с AUR
1. Обновляет систему, включая пакеты из AUR и даже development-версии программ (те, что заканчиваются на `-git`). Это полезно, если нужны самые свежие функции прямо из репозиториев разработчиков.
```
pamac upgrade -a --devel
```

1. Принудительно обновляет базы данных пакетов перед обновлением системы. Помогает, если возникла рассинхронизация с зеркалами.
```
pamac upgrade --force-refresh
```
---

### Инспекция файлов и пакетов
1. Выводит полный список файлов, которые установил в систему конкретный пакет.
```
pamac list -f [имя_пакета]
```

2. Показывает список всех пакетов, которые были установлены вами явно (не как зависимости для других программ).
```
pamac list -e
```

3. Позволяет найти пакет, которому принадлежит конкретный файл (даже если он еще не установлен).
```
pamac search -f [файл]
```
---

### Управление сторонними форматами
Если в вашей системе включена поддержка Snap или Flatpak.
```
# прямая установка из конкретного источника
pamac install [имя] --flatpak или --snap

# просмотр только установленных Flatpak-приложений
pamac list --flatpak
```
---

### Очистка и оптимизация
1. удаляет пакет и все его зависимости, которые больше не требуются ни одной другой программе.
```
pamac remove --orphans
```

2. Оставляет в кэше только две последние версии пакетов. Это золотая середина: вы экономите место, но сохраняете возможность быстрого «отката» на предыдущую версию, если новая работает нестабильно.
```
pamac clean --keep 2
```
---

### Полезные флаги
`--no-confirm` — можно добавить к любой команде установки или удаления, чтобы pamac не запрашивал подтверждение (удобно для автоматизации).\
`--no-clone` — при сборке из AUR не скачивать файлы заново, если они уже есть в системе.

**Важно**: Команды pamac update и pamac upgrade абсолютно идентичны по функционалу, вы можете использовать ту, которая вам привычнее.

---

## Команды для Flatpak
### Управление приложениями
1. Установка приложения (например, flatpak install flathub org.gimp.GIMP).
```
flatpak install [remote] [ID]
```

2. Удаление приложения.
```
flatpak uninstall [ID]
```

3. Запуск приложения через терминал.
```
flatpak run [ID]
```

4. Обновление всех установленных программ и системных сред.
```
flatpak update
```

5. Поиск приложений в подключенных репозиториях.
```
flatpak search [запрос]
```
---

### Просмотр информации
1. Список всех установленных приложений и библиотек (runtimes).
```
flatpak list
```

2. Показать только приложения.
```
flatpak list --app
```

3. Подробная информация о конкретном приложении (версия, разрешения, путь установки).
```
flatpak info [ID]
```

4. Просмотр истории изменений (установки, обновления, удаления).
```
flatpak history 
```
---

### Очистка системы
1. Удаление неиспользуемых библиотек и сред выполнения, которые больше не нужны ни одной программе.
```
flatpak uninstall --unused
```

2. Удаление приложения вместе с его пользовательскими данными в `~/.var/app/`.
```
flatpak uninstall --delete-data [ID] 
```

3. Полное удаление всех приложений Flatpak.
```
flatpak uninstall --all
```
---

### Управление репозиториями (Remotes)
1. Список всех подключенных источников.
```
flatpak remotes (или remote-list) 
```

2. Добавление нового репозитория (например, Flathub).
```
flatpak remote-add --if-not-exists flathub [URL]
```

3. Удаление источника из системы.
```
flatpak remote-delete [name]
```
---

### Продвинутые команды и отладка
1. Проверка и исправление целостности файлов установки при возникновении ошибок.
```
flatpak repair
```

2. Список запущенных в данный момент Flatpak-процессов.
```
flatpak ps 
```

3. Ручное изменение прав доступа приложения к папкам (например, чтобы дать доступ к вашему HDD).
```
flatpak override [ID] --filesystem=[path] 
```

4. Запрет на автоматическое обновление конкретного приложения.
```
flatpak mask [ID]
```
---

### Управление правами доступа (Sandbox)
Flatpak-приложения работают в изолированной «песочнице». Вы можете изменять их права вручную:
1. Дать приложению доступ к конкретной папке (например, вашему диску `/mnt/HDD01/`).
```
flatpak override [ID] --filesystem=/путь
```

2. Запретить приложению использовать определенный протокол (например, принудительно запустить через X11 для совместимости)
```
flatpak override [ID] --nosocket=wayland
```

3. Сбросить все ручные изменения прав доступа к заводским настройкам приложения.
```
flatpak override --reset [ID]
```
---

### Заморозка обновлений (Masking)
Если новая версия программы работает нестабильно, вы можете «замаскировать» её, чтобы она не обновлялась:
1. Запретить обновление конкретного приложения.
```
flatpak mask [ID]
```

2. Снова разрешить обновления.
```
flatpak mask --remove [ID]
```

3. Показать список всех заблокированных обновлений.
```
flatpak mask
```
---

### Диагностика и исправление
Если Flatpak ведет себя странно или приложения не запускаются:
1. Сканирует установленные пакеты на наличие повреждений и пытается их восстановить.
```
flatpak repair
```

2. Войти в оболочку (shell) запущенного контейнера приложения для отладки путей или переменных окружения.
```
flatpak enter [ID] sh
```

3. Показывает список запущенных в данный момент Flatpak-приложений и их идентификаторы процессов.
```
flatpak ps
```
---

### Работа с версиями и рантаймами
1. Закрепить рантайм (библиотеку), чтобы команда `uninstall --unused` не удалила его автоматически (полезно для старых приложений).
```
flatpak pin [ID]
```

2. Вывести список приложений с указанием их размера и места установки (системное или на другом диске).
```
flatpak list --columns=app,size,installation
```

3. Проверить наличие обновлений в репозиториях без их немедленной установки.
```
flatpak remote-ls --updates
```
---

### Создание портативных копий
Скопировать установленное приложение и его зависимости на USB-накопитель для установки на другой компьютер без интернета.
```
flatpak create-usb [путь_к_носителю] [ID]
```
---

